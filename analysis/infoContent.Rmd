---
title: "Information Content"
author: "Briana Mittleman"
date: "4/24/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
library(tidyverse)
library(ggpubr)
library(workflowr)
```

Packages/functions for this:

vegan: diversity, can calculate shannon or simpson

I will probably do this in python because I can go gene by gene easier: 

scipy stats example

This is good because I will be able to change the base and see how it effects the measurements 

https://kite.com/python/docs/scipy.stats.entropy

default base is e

```{python, eval=F}
from scipy.stats import entropy
import numpy as np
from math import log, e
entropy([1/2, 1/2], base=2)
  
#shannon 
Shannon2 = -np.sum(pA*np.log2(pA))
```


I most likely want to use a uniform prior. for this. I could get more complicated in the future by weighting differences by utr and intron. this would help find "more surpising" results. 

simpson- squares the probability 


```{bas,eval=F}
from ecopy import diversity 

diversity(x, medod="simpson")


#x- side x species matrix, sites are rows, columns are species - ie column counts, row == pas
```


```{r}
library(vegan)

data(BCI)
dim(BCI)
H <- diversity(BCI)
length(H)

diversity(c(.5,.5,.5))
diversity(c(.25,.75,.25))
#more peak= lower 


diversity(c(.5,.5,.5), "simpson")
diversity(c(.25,.75,.25),"simpson")
#more peak= lower


diversity(c(.5,.5,.5), "inv")
diversity(c(.25,.75,.25),"inv")


```


Seem like it is most simple to use the mean usages for this.  


First test:

use entropy in python with different bases. 
-base 2 is the classic shannon  and it uses the - when probabilities are given (ie uniform prior)

the python code will work with my meta file for now and take species as an input. 

```{bash,eval=F}
mkdir ../data/InfoContent

python InfoContentShannon.py Human
python InfoContentShannon.py Chimp



```

Results: 

```{r}
HumanResInfo= read.table("../data/InfoContent/Human_InfoContent.txt", header = T,stringsAsFactors = F) %>% rename(Human_Base2=base2, Human_basee= basee)
ChimpResInfo= read.table("../data/InfoContent/Chimp_InfoContent.txt", header = T,stringsAsFactors = F) %>% rename(Chimp_Base2=base2, Chimp_basee= basee)

BothResInfo= HumanResInfo %>% inner_join(ChimpResInfo, by=c("gene", "numPAS")) %>% filter(numPAS > 1)
```

First plot the distributions:

```{r}
BothResInfo_2= BothResInfo %>% select(gene, contains("Base2")) %>% gather("species", "base2", -gene)

ggplot(BothResInfo_2, aes(x=base2, fill=species)) + geom_density(alpha=.3)
```

Human shift higher, ie less density:  


```{r}
BothResInfo_e= BothResInfo %>% select(gene, contains("basee")) %>% gather("species", "basee", -gene)

ggplot(BothResInfo_e, aes(x=basee, fill=species)) + geom_density(alpha=.3)
```

I want to look at this by dominance: 

```{r}
ggplot(BothResInfo_2,aes(x=base2, fill=species)) + geom_histogram() + facet_grid(~species)
```



Plot human vs chimp: 

```{r}
ggplot(BothResInfo,aes(x=Human_Base2,y= Chimp_Base2 )) + geom_point() + geom_abline(slope=1, intercept = 0) + stat_cor() + geom_density_2d(col="blue")
```
```{r}
ggplot(BothResInfo,aes(x=Human_Base2,y= Chimp_Base2 ,col=numPAS)) + geom_point(alpha=.4) + geom_abline(slope=1, intercept = 0)
```

Does number explain: 

```{r}
summary(lm(BothResInfo$Human_Base2 ~BothResInfo$numPAS))


summary(lm(BothResInfo$Chimp_Base2 ~BothResInfo$numPAS ))
```
So this is working but the number of PAS explains most of the variation. Maybe I can normalize this out and look at residuals:  


```{r}
BothResInfoRes= BothResInfo %>% mutate(HumanNorm=residuals(BothResInfo$Human_Base2~BothResInfo$numPAS),ChimpNorm=residuals(BothResInfo$Chimp_Base2~BothResInfo$numPAS))
```




pull in dominance:  

```{r}
HumanRes=read.table("../data/DomDefGreaterX/Human_AllGenes_DiffTop.txt", col.names = c("Human_PAS", "gene","Human_DiffDom"),stringsAsFactors = F)

ChimpRes=read.table("../data/DomDefGreaterX/Chimp_AllGenes_DiffTop.txt", col.names = c("Chimp_PAS", "gene","Chimp_DiffDom"),stringsAsFactors = F)

BothRes=HumanRes %>% inner_join(ChimpRes,by="gene")

BothRes_10=BothRes %>% filter(Chimp_DiffDom >=0.1 | Human_DiffDom>=0.1) %>% mutate(Set= ifelse(Human_PAS==Chimp_PAS,"Same", "Different"),cut=10) 
BothRes_20=BothRes %>% filter(Chimp_DiffDom >=0.2 | Human_DiffDom>=0.2) %>% mutate(Set= ifelse(Human_PAS==Chimp_PAS,"Same", "Different"),cut=20)
BothRes_30=BothRes %>% filter(Chimp_DiffDom >=0.3 | Human_DiffDom>=0.3) %>% mutate(Set= ifelse(Human_PAS==Chimp_PAS,"Same", "Different"),cut=30)
BothRes_40=BothRes %>% filter(Chimp_DiffDom >=0.4 | Human_DiffDom>=0.4) %>% mutate(Set= ifelse(Human_PAS==Chimp_PAS,"Same", "Different"),cut=40)
BothRes_50=BothRes %>% filter(Chimp_DiffDom >=0.5 | Human_DiffDom>=0.5) %>% mutate(Set= ifelse(Human_PAS==Chimp_PAS,"Same", "Different"),cut=50)
BothRes_60=BothRes %>% filter(Chimp_DiffDom >=0.6 | Human_DiffDom>=0.6) %>% mutate(Set= ifelse(Human_PAS==Chimp_PAS,"Same", "Different"),cut=60)
BothRes_70=BothRes %>% filter(Chimp_DiffDom >=0.7 | Human_DiffDom>=0.7) %>% mutate(Set= ifelse(Human_PAS==Chimp_PAS,"Same", "Different"),cut=70)
BothRes_80=BothRes %>% filter(Chimp_DiffDom >=0.8 | Human_DiffDom>=0.8) %>% mutate(Set= ifelse(Human_PAS==Chimp_PAS,"Same", "Different"),cut=80)
BothRes_90=BothRes %>% filter(Chimp_DiffDom >=0.9 | Human_DiffDom>=0.9) %>% mutate(Set= ifelse(Human_PAS==Chimp_PAS,"Same", "Different"),cut=90)

BothResAll=BothRes_10 %>% bind_rows(BothRes_20) %>% bind_rows(BothRes_30) %>% bind_rows(BothRes_40) %>% bind_rows(BothRes_50) %>% bind_rows(BothRes_60) %>% bind_rows(BothRes_70) %>% bind_rows(BothRes_80) %>% bind_rows(BothRes_90)

```
I want dominance in 1 or both at .4.  

```{r}
BothRes_40_each= BothRes_40 %>% mutate(Dom=ifelse(Human_DiffDom>=.4, ifelse(Chimp_DiffDom >=.4, "Both", "Human"), "Chimp"))

BothRes_40_each %>% group_by(Dom) %>% summarise(n())

BothRes_40_each %>% group_by(Set,Dom) %>% summarise(n())
```

```{r}
BothRes_40_eachsm= BothRes_40_each %>% select(gene, Set, Dom)


BothResInfoDom= BothResInfo %>% full_join(BothRes_40_eachsm, by="gene", fill="None") %>%  mutate(Set= replace_na(Set, "None"),Dom= replace_na(Dom, "None"))


ggplot(BothResInfoDom,aes(x=Human_Base2,y= Chimp_Base2, col=Dom )) + geom_point(alpha=.3) + geom_abline(slope=1, intercept = 0) + scale_color_brewer(palette = "Set2") + labs(x="Human Information", y="Chimp Information", title="Shannon Information Index colored by whether gene has a dominanat PAS")


ggplot(BothResInfoDom,aes(x=Human_Base2,y= Chimp_Base2, col=Set )) + geom_point(alpha=.3) + geom_abline(slope=1, intercept = 0) + scale_color_brewer(palette = "Set2") +geom_density2d()+ labs(x="Human Information", y="Chimp Information", title="Shannon Information Index colored by Dominance Structure ")
```

```{r}

BothResInfoDom$numPAS=as.factor(BothResInfoDom$numPAS)
ggplot(BothResInfoDom,aes(x=Human_Base2,y= Chimp_Base2, col=numPAS )) + geom_point(alpha=.3) + geom_abline(slope=1, intercept = 0) + labs(x="Human Information", y="Chimp Information", title="Shannon Information Index colored by Dominance Structure ") + facet_grid(~Dom) + scale_color_brewer(palette = "Spectral")
```

Dominance and number of PAS:

```{r}
BothResInfoDom$numPAS=as.numeric(as.character(BothResInfoDom$numPAS))
ggplot(BothResInfoDom,aes(x=Dom, y=numPAS)) +geom_boxplot() +stat_compare_means()
```



Ratio problem!!!! 

but the confounder is biological- number of PAS.

