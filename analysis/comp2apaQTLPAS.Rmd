---
title: "Comparison to PAS from apaQTL project"
author: "Briana Mittleman"
date: "10/4/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
library(ggpubr)
library(tidyverse)
library(reshape2)
```

In this analysis I will compare the PAS found at 5% in the human data in this project with the apaQTL project.  

Take the 5 perc PAS from the annotatePAS analysis and filter those with scores > .05 in human. I also want to remove PAS not in chr 1-22.  


```{r}
chroms=c('chr10', 'chr11', 'chr12', 'chr13', 'chr14', 'chr15', 'chr16', 'chr17', 'chr18', 'chr19', 'chr1', 'chr2', 'chr20', 'chr21', 'chr22', 'chr3', 'chr4', 'chr5', 'chr6', 'chr7','chr8', 'chr9')

compAPAPAS=read.table("../data/Peaks_5perc/Peaks_5perc_either_HumanCoordHummanUsage.bed", header =   T, stringsAsFactors = F)  %>%  filter(Human>=0.05, chr %in% chroms) 

```


I can write this bed out and use bedtools intersect. 

```{bash,eval=F}
mkdir ../data/CompapaQTLpas
```


```{r}
write.table(compAPAPAS,"../data/CompapaQTLpas/CompAPA_PAS_5percHuman.bed", col.names = F, row.names = F, quote = F, sep="\t")
```

```{bash,eval=F}
sort -k1,1 -k2,2n ../data/CompapaQTLpas/CompAPA_PAS_5percHuman.bed > ../data/CompapaQTLpas/CompAPA_PAS_5percHuman.sort.bed

sbatch overlapapaQTLPAS.sh
```


Compare the ones with overlaps to those without:

```{r}
wOverlap=read.table("../data/CompapaQTLpas/PAS_5percHuman.sort.Intersect.bed", col.names = colnames(compAPAPAS)) %>% mutate(overlap="yes")
noOverlap=read.table("../data/CompapaQTLpas/PAS_5percHuman.sort.Intersect.NoOverlap.bed", col.names = colnames(compAPAPAS)) %>% mutate(overlap="no")

AllwOinfo=as.data.frame(rbind(wOverlap, noOverlap))

```


```{r}
ggplot(AllwOinfo, aes(x=overlap,fill=overlap)) +geom_bar(aes(y = (..count..)/sum(..count..)))+ scale_fill_brewer(palette = "Dark2")
```

```{r}
ggplot(AllwOinfo, aes(x=overlap, y=Human, fill=overlap)) + geom_boxplot() + scale_fill_brewer(palette = "Dark2")
```


Look at actual counts to see if this is a noise problem:



```{r}
humanCounts=read.table("../Human/data/CleanLiftedPeaks_FC/ALLPAS_postLift_LocParsed_Human_fixed.fc",header = T, stringsAsFactors = F) %>% select(-Chr, -Start,-End, -Strand, -Length)  %>% tidyr::separate(Geneid, sep = ":", into = c("disc", "PAS", "chr", "start", "end", "strand", "gene"))

humanCounts_mean=rowMeans(humanCounts[,8:19])

HumanMeanAnno= as.data.frame(cbind(PAS=humanCounts$PAS, meanCount=humanCounts_mean)) %>% inner_join(AllwOinfo, by= "PAS")

HumanMeanAnno$overlap=as.factor(HumanMeanAnno$overlap)
HumanMeanAnno$meanCount=as.integer(as.character(HumanMeanAnno$meanCount))
```

```{r}
ggplot(HumanMeanAnno, aes(x=overlap, y=log10(meanCount +1),fill=overlap)) + geom_boxplot() + scale_fill_brewer(palette = "Dark2")+ stat_compare_means(method="t.test") + labs(title="HC PAS counts by overlap with apaQTL PAS")
```

